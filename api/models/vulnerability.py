from api.extensions import db
from datetime import datetime

class Vulnerability(db.Model):
    __tablename__ = 'vulnerabilities'

    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(255), nullable=False)
    description = db.Column(db.Text)
    severity = db.Column(db.String(20)) # Low, Medium, High, Critical
    cve_id = db.Column(db.String(50))
    remediation = db.Column(db.Text)

class VulnerabilityInstance(db.Model):
    __tablename__ = 'vulnerability_instances'

    id = db.Column(db.Integer, primary_key=True)
    vulnerability_id = db.Column(db.Integer, db.ForeignKey('vulnerabilities.id'), nullable=False)
    scan_id = db.Column(db.Integer, db.ForeignKey('scans.id'), nullable=False)
    target_id = db.Column(db.Integer, db.ForeignKey('targets.id'), nullable=False)
    status = db.Column(db.String(20), default='open') # open, fixed, false_positive
    detected_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    vulnerability = db.relationship('Vulnerability', backref='instances')
    target = db.relationship('Target', backref='vulnerabilities')
